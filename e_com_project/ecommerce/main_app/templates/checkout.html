{% extends "master.html" %}
{% load static %}
{% comment %} {% block tophead %}
<!-- Top Header start -->
    <div class="top-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo">
                        <a href="">
                            <img src="{% static 'img/logo.png' %}" alt="Logo">
                        </a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="search">
                        <input type="text" placeholder="Search">
                        <button><i class="fa fa-search"></i></button>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="user">
                        {% if user.is_authenticate %}
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{user.username}}</a>
                            <div class="dropdown-menu">
                                <a href="{{curl}}/logout" class="dropdown-item">Logout</a>
                            </div>
                        </div>
                        {% endif %}
                    </div>  
                </div>
            </div>
        </div>
    </div>
    <!-- Top Header End -->
    {% endblock %} {% endcomment %}
    
{% block body %}
    <!-- Checkout Start -->
    <div class="checkout">
        <div class="container" style="padding-left:120px;">
            <div class="row">
                <div class="col-md-11">
                    <div class="checkout-summary" >
                        <h2 style="text-align:center;">Cart Total</h2>
                        <div class="checkout-content" >
                            <h3>Products</h3>
                            {% for item in data %}
                            <p>{{item.product_name}}&nbsp;&nbsp;&nbsp;<img src="{{curl}}/media/{{item.image}}" alt="Image" style="width:50px; height:40px;">
                                <span>{{item.price}}*{{item.quantity}} = ${{item.total_item_price}}</span></p>
                            {% endfor %}
                            <p class="sub-total">Sub Total<span>$</span></p>
                            {% comment %} <p class="ship-cost">Shipping Cost<span>$10</span></p> {% endcomment %}
                            <h4>Grand Total<span>$</span></h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-11">
                    <div class="billing-address">   
                        <h2 style="margin-top:20px; text-align:center;">Billing or Shipping details</h2>
                        <form method="POST" action="{% url 'create_checkout_session' %}">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6">
                                    <label>First Name</label>
                                    <input class="form-control" type="text" placeholder="First Name"  name="first_name" value="{{user_data.name}}">
                                </div>
                                <div class="col-md-6">
                                    <label>Last Name</label>
                                    <input class="form-control" type="text" placeholder="Last Name" name='last_name'>
                                </div>
                                <div class="col-md-6">
                                    <label>User Name</label>
                                    <input class="form-control" type="text" placeholder="User Name" required name='username'>
                                </div>
                                <div class="col-md-6">
                                    <label>E-mail</label>
                                    <input class="form-control" type="email" placeholder="E-mail" required name='email'>
                                </div>
                                <div class="col-md-6">
                                    <label>Mobile No</label>
                                    <input class="form-control" type="number" placeholder="Mobile No" required name='mobno'>
                                </div>
                                <div class="col-md-6">
                                    <label>Landmark</label>
                                    <input class="form-control" type="text" placeholder="landmark" required name='landmark'>
                                </div>
                                <div class="col-md-12">
                                    <label>Address</label>
                                    <input class="form-control" type="text" placeholder="Address" required name='address'>
                                </div>
                                <div class="col-md-6">
                                    <label>Country</label>
                                    <select class="custom-select" required name='country'>
                                        <option selected>United States</option>
                                        <option>Afghanistan</option>
                                        <option>Albania</option>
                                        <option>Algeria</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label>City</label>
                                    <input class="form-control" type="text" placeholder="City" required name='city'>
                                </div>
                                <div class="col-md-6">
                                    <label>State</label>
                                    <input class="form-control" type="text" placeholder="State" required name='state'>
                                </div>
                                <div class="col-md-6">
                                    <label>ZIP Code</label>
                                    <input class="form-control" type="text" placeholder="ZIP Code" required name='zip_code'>
                                </div>
                                <div class="col-md-6">
                                    <label>Current Date</label>
                                    <input class="form-control" type="date" placeholder="ZIP Code" required name='order_date'>
                                </div>
                                <div class="checkout-btn">
                                    <button type="submit" class="btn" style="margin:20px 0px 0px 430px; border-radius:7px;">Make Payment</button>
                                </div>
                            </div>
                        </form>    
                        </div>
                    </div>
                    {% comment %} <div class="checkout-payment">
                    <h2>Payment Methods</h2>
                    <div class="payment-methods">
                        <div class="payment-method">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" id="payment-1" name="payment">
                                <label class="custom-control-label" for="payment-1">Paypal</label>
                            </div>
                            <div class="payment-content" id="payment-1-show">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tincidunt orci ac
                                    eros volutpat maximus lacinia quis diam.
                                </p>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" id="payment-2" name="payment">
                                <label class="custom-control-label" for="payment-2">Payoneer</label>
                            </div>
                            <div class="payment-content" id="payment-2-show">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tincidunt orci ac
                                    eros volutpat maximus lacinia quis diam.
                                </p>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" id="payment-3" name="payment">
                                <label class="custom-control-label" for="payment-3">Check Payment</label>
                            </div>
                            <div class="payment-content" id="payment-3-show">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tincidunt orci ac
                                    eros volutpat maximus lacinia quis diam.
                                </p>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" id="payment-4" name="payment">
                                <label class="custom-control-label" for="payment-4">Direct Bank Transfer</label>
                            </div>
                            <div class="payment-content" id="payment-4-show">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tincidunt orci ac
                                    eros volutpat maximus lacinia quis diam.
                                </p>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" id="payment-5" name="payment">
                                <label class="custom-control-label" for="payment-5">Cash on Delivery</label>
                            </div>
                            <div class="payment-content" id="payment-5-show">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tincidunt orci ac
                                    eros volutpat maximus lacinia quis diam.
                                </p>
                            </div>
                        </div>
                    </div>{% endcomment %}
                </div> 
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const items = document.querySelectorAll(".checkout-content p");
        
            let subtotal = 0;
        
            function updateTotals() {
                subtotal = 0;
        
                items.forEach(item => {
                    const itemText = item.textContent.trim(); // Get the text content of the item
                    if (itemText.includes('= $')) {
                        const itemTotalPrice = parseFloat(itemText.split('= $')[1]);
                        subtotal += itemTotalPrice;
                    }
                });
        
                const shippingCost = 0.00; // Example shipping cost
                const grandTotal = subtotal + shippingCost;
        
                const subtotalElement = document.querySelector('.sub-total span');
                const grandTotalElement = document.querySelector('h4 span');
        
                if (subtotalElement && grandTotalElement) {
                    subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
                    grandTotalElement.textContent = `$${grandTotal.toFixed(2)}`;
                }
            }
        
            updateTotals();
        });
        
        </script>
        
    <!-- Checkout End -->
{% endblock %}